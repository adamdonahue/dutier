{"version":3,"sources":["../src/dutier.js"],"names":["root","factory","define","amd","exports","module","dispatch","getState","createStore","subscribe","combine","Dutier","global","_store","state","handlers","reducer","unsubscribe","handler","components","forEach","fn","index","splice","applyReducer","action","ret","reducers","Object","assign","keys","value","call","type","updateComponent","undefined","push","Promise","resolve","then","i","len","length"],"mappings":"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","file":"dutier.js","sourcesContent":[";(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define([], factory)\n  } else if (typeof exports === 'object') {\n    module.exports = {\n      dispatch: factory.dispatch,\n      getState: factory.getState,\n      createStore: factory.createStore,\n      subscribe: factory.subscribe,\n      combine: factory.combine,\n    }\n  } else {\n    root.Dutier = factory\n  }\n}(this, function (global) {\n  /**\n   * @name Dutier\n   * @description The object that will manage all application state\n   */\n  let Dutier = {\n    /**\n     * @name _store\n     * @description The private store\n     */\n    _store: {\n      /**\n       * @name state\n       * @description The initial store application state\n       */\n      state: {},\n      /**\n       * @name handlers\n       * @description The subscribe handlers function\n       */\n      handlers: [],\n      /**\n       * @name reducer\n       * @description The reducer function\n       */ \n      reducer: {}\n    }\n  }\n  /**\n   * @name unsubscribe\n   * @description Unsubscribes from listening to a component\n   * @param {Component} component The Component\n   **/\n  function unsubscribe(handler){\n    const components = Dutier._store.handlers\n    components.forEach( ( fn, index ) => {\n      if ( fn === handler) {\n        components.splice(index, 1)\n      }\n    })\n  }\n  // Apply the reducers function\n  function applyReducer ( action ) {\n    let ret=null\n    const reducers = Dutier._store.reducer\n    const state = Object.assign({}, Dutier._store.state)\n    Object.keys(reducers)\n      .forEach( reducer => {\n        const value = reducers[reducer].call(null, state, action)\n        if ( value !== state) { return ret = value }\n        ret = value; \n      })\n      \n    return Object.assign({}, { type: action.type } , { state: Object.assign({}, state, ret) } )\n  }\n  \n  // update the component\n  function updateComponent (action) {\n    Dutier._store.handlers.forEach( handler => {\n      if (handler !== undefined && typeof handler === 'function') {\n        handler(action)\n      }\n    })\n    return action\n  }\n  return {\n    /**\n     * @name subscribe\n     * @description Subscribe to call the handler function when the action will be triggered\n     * @param {Component} component The Component\n     * @param {Function} handler The function that will be called\n     **/\n    subscribe: ( handler ) => {\n      Dutier._store\n        .handlers\n        .push(handler)\n      return () => {\n        unsubscribe(handler)\n      }\n    },\n    /**\n     * @name dispatch\n     * @description Dispatch an action to change\n     * the store state\n     * @param { string } action The action name\n     */\n    dispatch: (action) => {\n      return Promise\n        .resolve(action)\n        .then(applyReducer)\n        .then(updateComponent)\n    },\n    /**\n     * @name createStore\n     * @description Sets the application data state\n     * @param {object} data Simple Object that contain the State\n     */\n    createStore: ( state, ...reducers ) => {\n      // register reducers\n      reducers.forEach( (reducer, i ) => Dutier._store.reducer[ i ] = reducer);\n      // setting the immutable initial state return Dutier.store\n      Object.assign(Dutier._store.state, state)\n    },\n    /**\n     * @name combine\n     * @description Combine the reducers\n     */\n    combine: ( ...reducers ) => {\n      const len =  Object.keys(Dutier._store.reducer).length\n      reducers.forEach( reducer => Dutier._store.reducer[len + 1] = reducer)\n    },\n    /**\n     * @name getState\n     * @return {Object} a copy of the state\n     */\n    getState: () => {\n      return Object.assign({}, Dutier._store.state)\n    }\n  }\n}(this)))"]}